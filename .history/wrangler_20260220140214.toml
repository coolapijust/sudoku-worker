# Cloudflare Worker 配置
# Sudoku Protocol Wasm Bridge

name = "sudoku-wasm-bridge"
main = "dist/index.js"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# =============================================================================
# 环境变量 (非敏感，可公开)
# =============================================================================
[vars]
# 上游 TCP 服务器配置
UPSTREAM_HOST = "127.0.0.1"
UPSTREAM_PORT = "8080"

# 加密方法选择:
# - "none": 无加密 (开发测试)
# - "aes-128-gcm": AES-128-GCM (Web Crypto API)
# - "chacha20-poly1305": ChaCha20-Poly1305 (Wasm 内实现)
CIPHER_METHOD = "chacha20-poly1305"

# 布局模式: "ascii" 或 "entropy"
LAYOUT_MODE = "ascii"

# Ed25519 公钥 (hex 编码，64 字符)
# 用于 Worker 身份验证 (可公开)
# 格式: 32 字节 hex = 64 字符
ED25519_PUBLIC_KEY = ""

# 密钥派生盐值 (可选)
KEY_DERIVE_SALT = "sudoku-v2-edge-salt"

# =============================================================================
# Secrets (敏感信息，通过 `wrangler secret put` 设置)
# =============================================================================
# 以下密钥必须通过命令行设置，不会出现在此文件中:
#
#   wrangler secret put SUDOKU_KEY
#   - AEAD 对称密钥 (32 字节 hex = 64 字符)
#   - 用于 ChaCha20-Poly1305 或 AES-GCM
#
#   wrangler secret put ED25519_PRIVATE_KEY  
#   - Ed25519 私钥 (32 字节 hex = 64 字符)
#   - 用于 Worker 身份签名 (可选)
#
# =============================================================================

# =============================================================================
# Wasm 模块绑定
# =============================================================================
[[wasm_modules]]
name = "SUDOKU_WASM"
path = "./sudoku.wasm"

# =============================================================================
# 路由配置 (可选，用于自定义域名)
# =============================================================================
# [[routes]]
# pattern = "sudoku.example.com/*"
# custom_domain = true

# =============================================================================
# 开发环境配置
# =============================================================================
[env.dev]
name = "sudoku-wasm-bridge-dev"

[env.dev.vars]
UPSTREAM_HOST = "localhost"
UPSTREAM_PORT = "8080"
CIPHER_METHOD = "none"
LAYOUT_MODE = "ascii"
ED25519_PUBLIC_KEY = ""
KEY_DERIVE_SALT = "dev-salt"

# =============================================================================
# 生产环境配置
# =============================================================================
[env.production]
name = "sudoku-wasm-bridge-prod"

[env.production.vars]
UPSTREAM_HOST = "upstream.example.com"
UPSTREAM_PORT = "443"
CIPHER_METHOD = "chacha20-poly1305"
LAYOUT_MODE = "ascii"
# ED25519_PUBLIC_KEY = "生产环境公钥"
KEY_DERIVE_SALT = "prod-sudoku-v2-salt"

# 生产环境建议添加自定义域名和路由
# [env.production.routes]
# pattern = "edge.sudoku-lab.com/*"
# custom_domain = true
